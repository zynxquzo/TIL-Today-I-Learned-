# ğŸ¨ [TIL] PostgreSQL ì‹¬í™”: JOIN, View, Subquery ë° ë°ì´í„° ë¶„ì„ ì‹¤ìŠµ

## 1. ğŸ–¼ï¸ ê°€ìƒ í…Œì´ë¸”, ë·° (View)

ë·°ëŠ” í•˜ë‚˜ ì´ìƒì˜ í…Œì´ë¸”ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ **ê°€ìƒì˜ í…Œì´ë¸”**ì…ë‹ˆë‹¤.

* **ì •ì˜**: ì‹¤ì œ ë°ì´í„°ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ì €ì¥í•˜ì§€ ì•Šìœ¼ë©°, ì •ì˜ëœ `SELECT` ì¿¼ë¦¬ë¬¸ì„ ì €ì¥í•˜ê³  ìˆë‹¤ê°€ í˜¸ì¶œ ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.
* **ì‹¤ì‹œê°„ ë°˜ì˜**: ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´ ë·°ë¥¼ í†µí•´ ë³´ëŠ” ë°ì´í„°ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.
* **ë…¼ë¦¬ì  ë…ë¦½ì„±**: í…Œì´ë¸” êµ¬ì¡°ê°€ ë³€ê²½ë˜ì–´ë„ ë·°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì˜í–¥ì„ ë°›ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ, ë·° ìì²´ëŠ” ì¬ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
* **ë³´ì•ˆ ë° í¸ì˜ì„±**: íŠ¹ì • ì»¬ëŸ¼ë§Œ ê³µê°œí•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•˜ê±°ë‚˜, ë°˜ë³µë˜ëŠ” ë³µì¡í•œ ì¡°ì¸ì„ ë¯¸ë¦¬ ì •ì˜í•´ë‘ì–´ ì‚¬ìš© íš¨ìœ¨ì„ ë†’ì…ë‹ˆë‹¤.
* **ì œì•½ì‚¬í•­**: ì¸ë±ìŠ¤ë¥¼ ì§ì ‘ ê°€ì§ˆ ìˆ˜ ì—†ìœ¼ë©°, ë‹¤ì¤‘ ì¡°ì¸ëœ ë·°ëŠ” ì‚½ì…, ìˆ˜ì •, ì‚­ì œ ì—°ì‚°ì— ì œì•½ì´ ë§ìŠµë‹ˆë‹¤.

---

## 2. ğŸ”„ ìê¸° ìì‹ ê³¼ì˜ ê²°í•©, ì…€í”„ ì¡°ì¸ (Self JOIN)

ê°™ì€ í…Œì´ë¸”ì„ ìê¸° ìì‹ ê³¼ ì¡°ì¸í•˜ëŠ” ë°©ì‹ì´ë©°, `INNER JOIN`, `LEFT JOIN` ë“± ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

* **í™œìš© ì‚¬ë¡€**: ì¡°ì§ë„ë‚˜ ê³„ì¸µ êµ¬ì¡°ë¥¼ í‘œí˜„í•  ë•Œ, ë°ì´í„° ê°„ì˜ ë¹„êµê°€ í•„ìš”í•  ë•Œ, ë˜ëŠ” ê·¸ë£¹ ë‚´ ìˆœìœ„ ë¹„êµ ì‹œ ì‚¬ìš©ë©ë‹ˆë‹¤.

---

## 3. ğŸ” ì¿¼ë¦¬ ì†ì˜ ì¿¼ë¦¬, ì„œë¸Œì¿¼ë¦¬ (Subquery)

ë‹¤ë¥¸ SQL ì¿¼ë¦¬ ë‚´ë¶€ì— í¬í•¨ëœ ì¿¼ë¦¬ë¬¸ìœ¼ë¡œ, ë©”ì¸ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ë¨¼ì € ì‹¤í–‰ë˜ì–´ ê·¸ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

* **íŠ¹ì§•**: ê´„í˜¸ `()` ì•ˆì— ì‘ì„±í•˜ë©°, ë‹¨ë… ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì™„ì „í•œ `SELECT` ë¬¸ì…ë‹ˆë‹¤.
* **ì„±ëŠ¥**: ë„ˆë¬´ ë§ì€ ì¤‘ì²©ì€ ì„±ëŠ¥ ì €í•˜ì˜ ì›ì¸ì´ ë  ìˆ˜ ìˆìœ¼ë©°, ë³´í†µ ì¡°ì¸(JOIN)ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ìƒ ë” ìœ ë¦¬í•©ë‹ˆë‹¤.

### ğŸ“ ìœ„ì¹˜ì— ë”°ë¥¸ ë¶„ë¥˜

| ë¶„ë¥˜ | ìœ„ì¹˜ | íŠ¹ì§• |
| --- | --- | --- |
| **ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬** | `SELECT` ì ˆ | í•˜ë‚˜ì˜ ê°’ë§Œ ë°˜í™˜ |
| **ì¸ë¼ì¸ ë·°** | `FROM` ì ˆ | ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ë¥¼ í•˜ë‚˜ì˜ í…Œì´ë¸”ì²˜ëŸ¼ ì·¨ê¸‰ |
| **ì¤‘ì²© ì„œë¸Œì¿¼ë¦¬** | `WHERE` / `HAVING` ì ˆ | ì¡°ê±´ì— í•„ìš”í•œ ê°’ ì œê³µ |

### â›“ï¸ ìƒê´€ ì„œë¸Œì¿¼ë¦¬ (Correlated Subquery)

* ë©”ì¸ ì¿¼ë¦¬ì˜ ì»¬ëŸ¼ì„ ì„œë¸Œì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•˜ì—¬ ì„œë¡œ ì—°ê´€ë˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
* ë©”ì¸ ì¿¼ë¦¬ì˜ ê° í–‰ë§ˆë‹¤ ì„œë¸Œì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ë¯€ë¡œ ì‹¤í–‰ ì†ë„ê°€ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 4. ğŸ”— ë‹¤ì¤‘í–‰ ì—°ì‚°ì (Multiple Row Operators)

ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ê°€ ì—¬ëŸ¬ í–‰ì„ ë°˜í™˜í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

* **IN / NOT IN**: ëª©ë¡ ì¤‘ ì¼ì¹˜í•˜ëŠ” ê°’ì´ ìˆëŠ”ì§€(ë˜ëŠ” ì—†ëŠ”ì§€) í™•ì¸í•©ë‹ˆë‹¤.
* **ANY**: ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°’ì´ í•˜ë‚˜ë¼ë„ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
* **ALL**: ëª¨ë“  ê°’ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
* **EXISTS / NOT EXISTS**: ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ê°€ ì¡´ì¬í•˜ëŠ”ì§€(ë˜ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ì§€) ì—¬ë¶€ë§Œ í™•ì¸í•©ë‹ˆë‹¤.

---

## 5. ğŸ’» dvdrental ì‹¤ìŠµ ì¿¼ë¦¬ ëª¨ìŒ

### ğŸ¬ ë°°ìš° ë° ì˜í™” ì •ë³´ (N:M ê´€ê³„)

```sql
-- 1. ë°°ìš°ê°€ ì¶œì—°í•œ ì˜í™”ì˜ ì œëª© ì¡°íšŒ
SELECT a.first_name, a.last_name, f.title
FROM actor a
JOIN film_actor fa ON a.actor_id = fa.actor_id
JOIN film f ON fa.film_id = f.film_id;

-- 2. ì˜í™”ë³„ ì¶œì—° ë°°ìš° ìˆ˜ ì¡°íšŒ (5ëª… ì´ˆê³¼ì¸ ë°ì´í„°ë§Œ)
SELECT f.title, COUNT(fa.actor_id) AS actor_count
FROM film f
JOIN film_actor fa ON f.film_id = fa.film_id
GROUP BY f.film_id, f.title
HAVING COUNT(fa.actor_id) > 5
ORDER BY actor_count DESC;

```

### ğŸ’³ ê³ ê° ëŒ€ì—¬ ë° ê²°ì œ ì •ë³´

```sql
-- 3. ê³ ê°ë³„ ëŒ€ì—¬ ì˜í™” ì œëª©, ì§€ë¶ˆ ê¸ˆì•¡, ë‚ ì§œ ì¡°íšŒ
SELECT c.first_name, f.title, p.amount, r.rental_date
FROM customer c
JOIN rental r ON c.customer_id = r.customer_id
JOIN inventory i ON r.inventory_id = i.inventory_id
JOIN film f ON i.film_id = f.film_id
JOIN payment p ON r.rental_id = p.rental_id;

-- 4. 'YENTL IDAHO' ì˜í™”ë¥¼ ëŒ€ì—¬í•œ ì¤‘ë³µ ì—†ëŠ” ê³ ê° ì •ë³´
SELECT DISTINCT c.first_name, c.last_name
FROM film f
JOIN inventory i ON f.film_id = i.film_id
JOIN rental r ON i.inventory_id = r.inventory_id
JOIN customer c ON r.customer_id = c.customer_id
WHERE f.title ILIKE 'Yentl Idaho';

```

### ğŸ“Š ëˆ„ë½ ë°ì´í„° ë° í†µê³„ ë¶„ì„

```sql
-- 5. ì¬ê³ (inventory)ê°€ ì—†ëŠ” ì˜í™” ì°¾ê¸° (LEFT JOIN í™œìš©)
SELECT f.film_id, f.title
FROM film f
LEFT JOIN inventory i ON f.film_id = i.film_id
WHERE i.inventory_id IS NULL;

-- 6. ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  ëŒ€ì—¬ë£Œ ì¡°íšŒ
SELECT c.name, AVG(f.rental_rate)
FROM category c
JOIN film_category fc ON c.category_id = fc.category_id
JOIN film f ON fc.film_id = f.film_id
GROUP BY c.name;

```

---

## 6. ğŸ’¡ í•™ìŠµ í¬ì¸íŠ¸ (Troubleshooting)

* **ë‹¤ì¤‘ JOIN íë¦„**: ì§ì ‘ì ì¸ ì—°ê²° ê³ ë¦¬ê°€ ì—†ëŠ” í…Œì´ë¸”ì€ ì¤‘ê°„ ë§¤ê°œì²´(ì˜ˆ: `inventory`, `film_actor`)ë¥¼ ë°˜ë“œì‹œ ê±°ì³ì•¼ ì •ë³´ë¥¼ í†µí•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ILIKEì˜ í™œìš©**: ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê³  ê²€ìƒ‰í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.
* **DISTINCT ì‚¬ìš©**: JOINìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” í–‰ì˜ ì¤‘ë³µì„ ì œê±°í•˜ì—¬ ì •í™•í•œ ì—”í‹°í‹° ìˆ˜ë¥¼ íŒŒì•…í•  ë•Œ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
* **NULLì˜ ì˜ë¯¸**: `LEFT JOIN` ì‹œ ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì˜ ê°’ì´ `NULL`ì¸ ë°ì´í„°ëŠ” ì—°ê²°ëœ ì •ë³´ê°€ ì—†ëŠ” "ë¹ˆ í‹ˆ"ì„ ì°¾ëŠ” í•µì‹¬ ë‹¨ì„œê°€ ë©ë‹ˆë‹¤.
