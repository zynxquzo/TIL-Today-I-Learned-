## [TIL] 데이터베이스 모델링: 인스타그램 핵심 기능 및 채팅 시스템 설계

### 1. 프로젝트 개요 및 목적

* **핵심 목적**: 사용자 간 상호작용이 활발한 소셜 미디어의 특성을 반영하여 팔로우 및 대댓글 그리고 다중 미디어 관리와 실시간 채팅 구조를 설계합니다.
* **설계 도구**: `draw.io`를 활용하여 엔티티 간의 관계를 시각화하고 외래키 참조 구조를 정의하였습니다.
* **주요 엔티티**: `user`(사용자)와 `post`(게시물)를 중심으로 `user_follow`(팔로우) 및 `post_comment`(댓글)와 `chating_room`(채팅방) 등으로 구성했습니다.

### 2. 정규화 및 데이터 분리 전략

서비스의 확장성과 데이터 무결성을 유지하기 위해 중복 요소를 제거하고 테이블을 세분화했습니다.

* **게시물 미디어 분리**: 게시물 하나에 여러 장의 사진이나 영상을 올릴 수 있도록 `post` 테이블에서 이미지 경로를 제거하고 1대N 관계의 `post_image` 테이블로 독립시켰습니다.
* **좋아요 및 북마크 분리**: 게시물에 대한 사용자 반응을 별도 테이블인 `post_like`와 `post_bookmark`로 관리하여 어떤 사용자가 어떤 게시물에 반응했는지 개별적으로 추적 가능하게 설계했습니다.
* **다대다 채팅 구조화**: 채팅방과 사용자 사이의 다대다(N:M) 관계를 해소하기 위해 `chating_room_user` 매핑 테이블을 생성하여 다중 참여 구조를 마련했습니다.

### 3. 자기 참조와 역정규화 전략

복잡한 계층 구조 처리와 조회 성능 향상을 위해 특정 설계 기법을 도입했습니다.

* **댓글 계층 구조를 위한 자기 참조(Self-Join)**:
* `post_comment` 테이블 내에 `reply_commentID` 필드를 생성하여 상위 댓글의 ID를 참조하도록 설계했습니다.
* **이유**: 별도의 답글 테이블 없이도 하나의 테이블 내에서 계층적인 대댓글 구조를 논리적으로 구현할 수 있기 때문입니다.


* **조회 성능 최적화를 위한 역정규화(Denormalization)**:
* `post` 테이블에 `좋아요 수` 필드를 직접 포함시켰습니다.
* **이유**: 게시물 목록 조회 시 매번 `post_like` 테이블을 집계하는 연산 비용을 줄여 메인 피드의 로딩 속도를 높이기 위함입니다.



### 4. 핵심 설계 포인트 요약

* **채팅 및 메시지 시스템**: `chating_room` 테이블로 방을 생성하고 `message` 테이블이 해당 방의 ID와 작성자 ID를 참조하게 하여 대화 내역을 시간순으로 관리합니다.
* **팔로우 및 차단 로직**: `user_follow` 테이블에 신청 상태 필드를 두어 비공개 계정 로직을 처리하며 `block` 테이블을 통해 차단 기능을 반영했습니다.
* **이미지 정렬 순서**: `post_image` 테이블에 `정렬순서` 필드를 추가하여 게시물 내에서 사용자가 의도한 사진 순서를 유지하도록 보장했습니다.

### 5. 학습 포인트 (Troubleshooting)

* **매핑 테이블의 활용**: 사용자 활동이 겹치는 채팅방이나 팔로우 관계에서 중간 테이블을 활용하여 데이터 중복을 방지하고 관계를 명확히 정의했습니다.
* **식별자 일관성**: 모든 관계 테이블에 `chating_room_userID`와 같은 고유한 기본키(PK)를 설정하여 데이터 관리의 정확성을 확보했습니다.
* **참조 무결성 유지**: 메시지가 어느 방에 속하는지 또는 댓글이 어느 게시물에 속하는지 외래키(FK)를 통해 연결하여 데이터 간의 연결을 반영했습니다.

---

**오늘의 배움:** 소셜 미디어 설계는 단순한 포스팅을 넘어 사용자 간의 유기적인 연결인 채팅과 팔로우를 매핑 테이블 및 자기 참조로 풀어내는 과정이며 성능을 위한 역정규화 전략이 병행되어야 함을 학습했습니다.

---

### 🖼️ 첨부: 인스타그램 및 채팅 시스템 통합 ERD
![Instagram_DB_ERD](https://github.com/user-attachments/assets/b209f9c1-62a1-4334-a249-24d233b7e1bc)