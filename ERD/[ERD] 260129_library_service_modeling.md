## [TIL] 데이터베이스 모델링: 도서관 통합 관리 시스템 설계

### 1. 프로젝트 개요 및 목적 

* **핵심 목적**: 도서 대출, 반납, 예약 및 연체료 수납을 관리하는 통합 시스템을 설계하고 대량 데이터 조회 성능 최적화를 고려한 스키마를 구축합니다.
* **설계 도구**: `draw.io`를 활용하여 개체-관계 다이어그램(ERD)을 시각화하였습니다.
* **주요 엔티티**: `Book_info`(도서 정보), `Book_item`(실물 도서), `Rental`(대출), `Penalty`(연체료), `Payment`(결제) 등을 중심으로 구조화했습니다.

### 2. 정규화 및 데이터 분리 전략 

현실적인 도서관 운영 로직을 반영하기 위해 데이터를 역할별로 세분화하여 분리했습니다.

* **도서 정보와 실물 분리**: 똑같은 책이라도 도서관에는 여러 권이 존재하므로 공통 정보인 `Book_info`와 개별 식별 번호를 가진 `Book_item`을 분리했습니다.
* **지점(Library) 관리**: 다중 지점 운영을 가정하여 특정 책이 어느 도서관에 소속되어 있고 어디서 예약이 가능한지 관리할 수 있도록 설계했습니다.
* **벌금과 결제의 분리**: 연체 시 부과되는 벌금(`Penalty`)은 고지서 역할을 하고 실제 수납 기록인 `Payment`는 영수증 역할을 하도록 분리하여 분할 납부나 결제 수단 추적이 가능하게 했습니다.

### 3. 역정규화와 예약 시스템 

성능 최적화와 사용자 편의성을 위해 역정규화를 적용했습니다.

* **조회 성능을 위한 역정규화(Denormalization)**:
* `Book_item` 테이블에 `대여상태` 필드를 직접 포함시켰습니다.
* **이유**: 사용자가 도서를 검색할 때 매번 `Rental` 이력을 조인(Join)하여 계산하지 않고  `Book_item` 테이블 하나만 조회해도 즉시 대출 가능 여부를 확인할 수 있도록 했습니다.


* **예약 로직의 유연성**: `Reservation`은 특정 책(`Book_item`)이 아닌 도서 정보(`Book_info`)와 연결했습니다. 이는 특정 실물 한 권을 기다리는 것이 아니라 해당 도서 중 먼저 반납되는 것을 대기열에 따라 빌려주기 위함입니다.

### 4. 핵심 설계 포인트 요약 

* **반납 예정일(Due Date) 관리**: `Rental` 테이블에 예정일과 연장 횟수를 두어 시스템이 자동으로 연체 여부를 판단하고 연체료를 계산할 수 있는 기반을 마련했습니다.
* **다중 결제 대응**: `Payment` 테이블이 `PenaltyID`를 외래키(FK)로 가지게 하여 하나의 벌금에 대해 여러 번 나누어 결제하거나 카드/포인트를 혼합해서 결제하는 상황에 대응했습니다.
* **사용자 상태 제어**: `Customer` 테이블에 `연체-대출금지날짜설정` 필드를 두어 연체료 미납 시 비즈니스 로직에서 대출 기능을 원천 차단할 수 있도록 설계했습니다.

### 5. 학습 포인트 (Troubleshooting) 

* **역정규화 활용**: 처음에는 모든 상태를 조인(JOIN)으로 처리하려 했으나 검색 성능 저하 문제를 예상하고 의도적인 데이터 중복(역정규화)을 통해 실무적인 해결책을 찾았습니다.
* **데이터 무결성 유지**: 역정규화를 선택한 만큼 반납 시 `Rental`과 `Book_item`의 상태를 동시에 업데이트해야 하는 트랜잭션 관리의 중요성을 깨달았습니다.
* **확장성 고려**: 상호대차(지점 간 이동) 기능은 제외했지만 `LibraryID`를 곳곳에 배치하여 추후 지점 확장 시 스키마 변경을 최소화할 수 있도록 대비했습니다.

---

**오늘의 배움:** 데이터베이스 설계는 단순히 데이터를 저장하는 틀을 만드는 것이 아니라 서비스의 병목 현상(조회 성능)을 예측하고 현실의 복잡한 규칙(부분 결제, 예약 로직)을 가장 효율적인 데이터 흐름으로 치환하는 전략적 과정임을 배웠습니다.

---

### 🖼️ 첨부: 도서관 관리 시스템 최종 ERD
![Library_DB_ERD](https://github.com/user-attachments/assets/14a28cdf-a3a8-4799-96ea-57cb649ce8eb)


